<app-navbar></app-navbar>

<div class="page-container">
  <div class="card">
    
    <h2>Résultats TOEIC des Étudiants</h2>

    <div class="filters-container">
      <div class="filters-grid">
        <select class="search-bar" id="siteFilter" (change)="onSiteChange($event)">
          <option value="">Sélectionner un site</option>
          <option *ngFor="let site of sites" [value]="site.id">{{ site.nom }}</option>
        </select>

        <select class="search-bar" id="promoFilter" (change)="onPromotionChange($event)">
          <option value="">Sélectionner une promotion</option>
          <option *ngFor="let promotion of promotions" [value]="promotion.id">{{ promotion.nom }}</option>
        </select>

        <select class="search-bar" id="semestreFilter" (change)="onSemestreChange($event)">
          <option value="">Sélectionner un semestre</option>
          <option *ngFor="let semestre of semestres" [value]="semestre.id">{{ semestre.nom }}</option>
        </select>

        <select class="search-bar" id="groupFilter" (change)="onGroupeChange($event)">
          <option value="">Sélectionner un groupe</option>
          <option *ngFor="let groupe of groupes" [value]="groupe.id">{{ groupe.nom }}</option>
        </select>

        <select class="search-bar" id="testFilter" style="grid-column: 1 / -1;">
          <option value="">Sélectionner un test</option>
          <option *ngFor="let test of tests" [value]="test.id">{{ test.nom }}</option>
        </select>
      </div>
    </div>

    <div class="actions-row">
      
      <div class="pdf-group">
        <button class="btn-download-pdf" (click)="downloadOralPDF()">
          <i class="fas fa-file-pdf"></i> PDF Oral
        </button>
        <button class="btn-download-pdf" (click)="downloadEcritPDF()">
          <i class="fas fa-file-pdf"></i> PDF Écrit
        </button>
        <button class="btn-download-pdf" style="background-color: #28a745;" (click)="exportTableToCSV('toeic_results.csv')">
          <i class="fas fa-file-csv"></i> CSV
        </button>
      </div>

      <div class="score-group">
        <button class="btn-score" (click)="showResultsTable()">
          <i class="fas fa-eye"></i> Voir Score
        </button>
      </div>

    </div>

    <div class="mt-4 table-responsive" *ngIf="showTable">
      <table class="table-flat" id="resultsTable">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Prénom</th>
            <th>H2 Oral (/100)</th>
            <th>Note Oral /20</th>
            <th>Score Oral</th>
            <th>H2 Écrit (/100)</th>
            <th>Note Écrit /20</th>
            <th>Score Écrit</th>
            <th>Total TOEIC</th>
            <th>Note C.C</th>
            <th>Note ECUE</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of students">
            <td>{{ student.nom }}</td>
            <td>{{ student.prenom }}</td>
            <td>{{ student.h2_oral }}</td>
            <td>{{ student.note_oral }}</td>
            <td>{{ student.score_oral }}</td>
            <td>{{ student.h2_ecrit }}</td>
            <td>{{ student.note_ecrit }}</td>
            <td>{{ student.score_ecrit }}</td>
            <td style="font-weight: bold; color: #004e92;">{{ student.score_total_toeic }}</td>
            <td>{{ student.note_cc }}</td>
            <td>{{ student.note_ecue_toeic }}</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>